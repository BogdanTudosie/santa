<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secret Santa Reveal</title>

<style>
body {
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}
.container {
    background: white;
    padding: 35px;
    border-radius: 12px;
    max-width: 600px;
    width: 100%;
    text-align: center;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}
.assignment-box {
    margin-top: 25px;
    background: #f8f9fa;
    padding: 25px;
    border-radius: 10px;
    border-left: 4px solid #28a745;
}
</style>
</head>

<body>
<div class="container">
    <h1>üéÖ Secret Santa Reveal</h1>
    <div id="message">Loading...</div>
    <div id="result"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore-compat.js"></script>

<script>
// -------------------------------------------------------------
// üî• INSERT YOUR FIREBASE CONFIG HERE
// -------------------------------------------------------------
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBUbmtR7uU9YaUDeGDOS4Q-IP2zC90kPmc",
  authDomain: "secret-santa-d2b69.firebaseapp.com",
  projectId: "secret-santa-d2b69",
  storageBucket: "secret-santa-d2b69.firebasestorage.app",
  messagingSenderId: "190272496238",
  appId: "1:190272496238:web:4547ce0af13692973dfc7f",
  measurementId: "G-F5NZFG8298"
};
// -------------------------------------------------------------

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Read ?id=XXXX from URL
const params = new URLSearchParams(window.location.search);
const userID = params.get("id");

const message = document.getElementById("message");
const result = document.getElementById("result");

async function load() {
    // If no ID provided
    if (!userID) {
        message.innerHTML = "‚ùå Invalid or missing link.";
        return;
    }

    try {
        const snap = await db.collection("secretSanta").doc("assignments").get();

        if (!snap.exists) {
            message.innerHTML = "‚ùå Configuration not found.";
            return;
        }

        const data = snap.data();

        // Look up name by private ID
        const name = data.ids[userID];

        if (!name) {
            message.innerHTML = "‚ùå Unknown or expired link.";
            return;
        }

        // Look up recipient
        const recipient = data.assignments[name];

        if (!recipient) {
            message.innerHTML = "‚ùå Assignment missing for this user.";
            return;
        }

        // Success!
        message.innerHTML = "";
        result.innerHTML = `
            <div class="assignment-box">
                <h2>You are Secret Santa for:</h2>
                <h1>${recipient}</h1>
            </div>
        `;

    } catch (err) {
        console.error("Error:", err);
        message.innerHTML = "‚ùå There was a problem loading your assignment.";
    }
}

load();
</script>
</body>
</html>
